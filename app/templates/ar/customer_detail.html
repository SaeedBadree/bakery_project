{% extends "base.html" %}

{% block title %}{{ customer.name }} - Bakery POS{% endblock %}

{% block content %}
<h1>{{ customer.name }}</h1>

<div class="card">
    <h2>Customer Info</h2>
    <p><strong>Balance:</strong> ${{ "%.2f"|format(customer.balance) }}</p>
    <p><strong>Credit Limit:</strong> ${{ "%.2f"|format(customer.credit_limit) }}</p>
    {% if customer.email %}<p><strong>Email:</strong> {{ customer.email }}</p>{% endif %}
    {% if customer.phone %}<p><strong>Phone:</strong> {{ customer.phone }}</p>{% endif %}
</div>

<div class="card">
    <h2>Aging</h2>
    <table class="table">
        <thead>
            <tr>
                <th>0-30 Days</th>
                <th>31-60 Days</th>
                <th>61-90 Days</th>
                <th>90+ Days</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>${{ "%.2f"|format(aging['0-30']) }}</td>
                <td>${{ "%.2f"|format(aging['31-60']) }}</td>
                <td>${{ "%.2f"|format(aging['61-90']) }}</td>
                <td>${{ "%.2f"|format(aging['90+']) }}</td>
            </tr>
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Record Payment</h2>
    <form method="post" action="/ar/customers/{{ customer.id }}/payment">
        <div class="form-group">
            <label>Amount</label>
            <input type="number" name="amount" step="0.01" min="0" required>
        </div>
        <div class="form-group">
            <label>Notes</label>
            <textarea name="notes"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Record Payment</button>
    </form>
</div>

<div class="card">
    <h2>Ledger</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Balance</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in entries %}
            <tr>
                <td>{{ entry.date.strftime('%Y-%m-%d') }}</td>
                <td>{{ entry.entry_type.value }}</td>
                <td>${{ "%.2f"|format(entry.amount) }}</td>
                <td>${{ "%.2f"|format(entry.balance) }}</td>
                <td>{{ entry.notes or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<a href="/ar/customers/{{ customer.id }}/statement" class="btn btn-secondary">Print Statement</a>
{% endblock %}

